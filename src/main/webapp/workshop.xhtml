<?xml version="1.0" encoding="UTF-8"?>
<ui:composition template="_main.xhtml"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:b="http://bootsfaces.net/ui"
                xmlns:p="http://primefaces.org/ui">

    <ui:define name="resources">
        <script type="text/javascript">
            function selectAllCheckBoxes() {
                var pattern = $(this).attr('id').split(':')[0];
                var checked = $(this).is(":checked");

                $(":checkbox[id^=" + pattern + "]").each(function () {
                    $(this).prop('checked', checked);
                    var checkDiv = $(this).parent().next();
                    if (checked) {
                        checkDiv.addClass('ui-state-active');
                        checkDiv.children('span').removeClass('ui-icon-blank');
                        checkDiv.children('span').addClass('ui-icon-check');
                    } else {
                        checkDiv.removeClass('ui-state-active');
                        checkDiv.children('span').removeClass('ui-icon-check');
                        checkDiv.children('span').addClass('ui-icon-blank');
                    }
                });
            }

            $(function () {
                $("#selectedMitigationIndicatorsBox\\:0").change(selectAllCheckBoxes);
                $("#selectedProductionIndicatorsBox\\:0").change(selectAllCheckBoxes);
                $("#selectedAdaptationIndicatorsBox\\:0").change(selectAllCheckBoxes);
            });
        </script>
    </ui:define>

    <ui:define name="content">
        <b:container>
            <b:row>
                <b:column span="6">
                    <b:well>
                        <p>Welcome to the CSA prioritization Tool. At the end of this process, you will be presented
                            with some portfolios of CSA practices based on your initial search, the weight you assign
                            to each CSA pillar, and the new data you want to add. </p>

                        <p>This is you what you have to do:</p>
                        <ol>
                            <li>Enter the workshop information and Save. Don't worry: you can add more details afterwards.</li>
                            <li>Select from the practices found in the search, those you want to use in the process.
                                You can also add your own data.
                            </li>
                            <li>Distribute the weight of each CSA pillar in you decision process.</li>
                            <li>Chose the performance indicators you want to be taken into account for the process, according
                                to your requirements.
                            </li>
                        </ol>
                    </b:well>
                </b:column>

                <h:form id="workshop">

                    <b:column span="6">
                        <h2>Workshop Information</h2>
                        <p:outputLabel for="workshopCountryCode" value="Country:"/> <br/>
                        <h:selectOneMenu id="workshopCountryCode"
                                         value="#{workshopController.workshopCountryCode}" label="Country">
                            <f:selectItem itemValue="0" itemLabel="--" noSelectionOption="true"/>
                            <f:selectItems value="#{searchController.countriesList}"/>
                        </h:selectOneMenu>
                        <br/>
                        <br/>
                        <p:outputLabel for="partners" value="Partners:"/> <br/>
                        <p:inputTextarea id="partners" rows="6" cols="33"/>

                        <h3>Search Parameters</h3>
                        <ui:repeat value="#{resultsController.searchParametersList}" var="parameter">
                            <strong>#{parameter}:</strong> #{resultsController.searchParametersInfo[parameter]}
                            <br/>
                        </ui:repeat>
                    </b:column>

                </h:form>
            </b:row>

            <b:row>
                <b:column span="6" offset="3">
                    <h2>Practices Selection</h2>
                    <p:pickList value="#{workshopController.practices}" var="practice" itemLabel="#{practice.name}"
                                itemValue="#{practice}">
                        <f:facet name="sourceCaption">Available practices</f:facet>
                        <f:facet name="targetCaption">Selected practices</f:facet>
                    </p:pickList>

                </b:column>
            </b:row>

            <b:row>
                <b:column span="8" offset="2">
                    <b:well>
                        <b:row>
                            <b:column span="7">
                                <p:chart id="pillarsPie" type="pie" model="#{workshopController.pieModel}"
                                         style="width:400px; height:300px"/>
                            </b:column>
                            <b:column span="4" styleClass="sliders-panel">
                                <h4>Assign Weight</h4>

                                <div class="slider-box">
                                    <h:inputHidden id="mitigation" value="#{workshopController.mitigationValue}"/>
                                    <p:slider for="mitigation" display="mitigationOutput"
                                              style="width: 230px; background: #4BB2C5"
                                              displayTemplate="Mitigation: %{value}">
                                        <p:ajax event="slideEnd" listener="#{workshopController.checkSlider()}"
                                                update="pillarsPie"/>
                                    </p:slider>
                                    <h:outputText id="mitigationOutput"
                                                  value="Mitigation: %#{workshopController.mitigationValue}"/>
                                </div>

                                <div class="slider-box">
                                    <h:inputHidden id="production" value="#{workshopController.productionValue}"/>
                                    <p:slider for="production" display="productionOutput"
                                              style="width: 230px; background: #EAA228"
                                              displayTemplate="Production: %{value}"/>
                                    <h:outputText id="productionOutput"
                                                  value="Production: %#{workshopController.productionValue}"/>
                                </div>
                                <div class="slider-box">

                                    <h:inputHidden id="adaptation" value="#{workshopController.adaptationValue}"/>
                                    <p:slider for="adaptation" display="adaptationOutput"
                                              style="width: 230px; background: #C5B47F"
                                              displayTemplate="Adaptation: %{value}"/>
                                    <h:outputText id="adaptationOutput"
                                                  value="Adaptation: %#{workshopController.adaptationValue}"/>
                                </div>
                            </b:column>
                        </b:row>
                    </b:well>
                </b:column>
            </b:row>
            <b:row>
                <b:column span="8" offset="2">
                    <b:well>
                        <div style="text-align: center; margin-bottom: 30px">
                            <h3>Select Indicators</h3>
                        </div>
                        <b:row>
                            <b:column span="4">
                                <div class="indicator-title" style="background-color: #4BB2C5;">
                                    <h4>Mitigation</h4>
                                </div>
                                <p:selectManyCheckbox id="selectedMitigationIndicatorsBox"
                                                      value="#{workshopController.selectedMitigationIndicators}"
                                                      layout="pageDirection">
                                    <f:selectItem itemValue="0" itemLabel="Select All"/>
                                    <f:selectItems value="#{workshopController.mitigationIndicators}"
                                                   var="indicator"
                                                   itemLabel="#{indicator.name}" itemValue="#{indicator.id}"/>
                                </p:selectManyCheckbox>
                            </b:column>
                            <b:column span="4">
                                <div class="indicator-title" style="background-color: #EAA228;">
                                    <h4>Production</h4>
                                </div>
                                <p:selectManyCheckbox id="selectedProductionIndicatorsBox"
                                                      value="#{workshopController.selectedProductionIndicators}"
                                                      layout="pageDirection">
                                    <f:selectItem itemValue="0" itemLabel="Select All"/>
                                    <f:selectItems value="#{workshopController.productionIndicators}"
                                                   var="indicator"
                                                   itemLabel="#{indicator.name}" itemValue="#{indicator.id}"/>
                                </p:selectManyCheckbox>

                            </b:column>
                            <b:column span="4">
                                <div class="indicator-title" style="background-color: #C5B47F;">
                                    <h4>Adaptation</h4>
                                </div>
                                <p:selectManyCheckbox id="selectedAdaptationIndicatorsBox"
                                                      value="#{workshopController.selectedAdaptationIndicators}"
                                                      layout="pageDirection">
                                    <f:selectItem itemValue="0" itemLabel="Select All"/>
                                    <f:selectItems value="#{workshopController.adaptationIndicators}"
                                                   var="indicator"
                                                   itemLabel="#{indicator.name}" itemValue="#{indicator.id}"/>
                                </p:selectManyCheckbox>

                            </b:column>
                        </b:row>

                    </b:well>
                </b:column>
            </b:row>
            <b:row>
                <b:column span="2" offset="5">
                    <div class="title"><input class="btn-search" type="button" value="Continue"
                                              onClick="window.location.href='practices.xhtml'"/></div>
                </b:column>
            </b:row>
        </b:container>
    </ui:define>
</ui:composition>
