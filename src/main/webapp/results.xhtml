<?xml version="1.0" encoding="UTF-8"?>
<ui:composition template="_main.xhtml"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:b="http://bootsfaces.net/ui">

    <ui:define name="resources">
        <h:outputScript name="js/compendium-gis.js" target="head"/>
        <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css"/>
        <script type="text/javascript" src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
    </ui:define>

    <ui:define name="content">
        <b:container>
            <b:row>
                <b:column span="4">
                    <div class="search-results">
                        <ui:repeat id="article" value="#{resultsController.articles}" var="article">
                            <b:panel id="panel">
                                <f:facet name="heading">
                                    <a href="javascript:highlightArticle('#{article.code}')">#{article.code}</a>
                                </f:facet>

                                <strong>Title: </strong> #{article.title} <br/>
                                <strong>Year: </strong> #{article.publicationDate.year} <br/>
                                <strong>Location: </strong> #{article.location.place}, #{article.location.country} <br/>

                                <div id="details_panel_#{article.code}" class="details-panel">
                                    <strong>Theme: </strong> #{article.practiceTheme.name}  <br/>
                                    <strong>Farming System: </strong> #{article.farmingSystem.name} <br/>
                                    <strong>Practice: </strong> #{article.treatments[0].practice.name} <br/>
                                    <strong>Production system: </strong> #{article.treatments[0].productionSystems[0].name}
                                </div>

                                <h6 class="hide">#{article.code}/#{article.location.latitude}/#{article.location.longitude}</h6>

                                <f:facet name="footer">
                                    <a id="details_link_#{article.code}"
                                       href="javascript:toggleArticleDetails('#{article.code}')">Show Details</a>
                                </f:facet>
                            </b:panel>
                        </ui:repeat>
                    </div>
                    <div class="center-block" style="margin-top: 16px">
                        <input id="search-btn" class="btn-search" type="button" value="Start Prioritization"
                               onclick="window.location.href='workshop.xhtml'"/>
                    </div>
                </b:column>

                <b:column span="8">
                    <div id="map" style="height:660px"></div>
                </b:column>
            </b:row>
        </b:container>

        <script type="text/javascript">
            $(function () { // Called when DOM is ready
                loadMap('map', 'h6', '/');
            });
        </script>
    </ui:define>
</ui:composition>
