/**
 * This is the Gradle build script.
 */

description = "This is the CSA Prioritization Tool build file. It uses spring boot."

buildscript {
    repositories {
        jcenter()
        maven { url "http://repo.spring.io/libs-snapshot" } 
    }
    dependencies {
        // Spring boot integration with gradle
        classpath("org.springframework.boot:spring-boot-gradle-plugin:1.2.0.RC2")
        // Plugin to reload changed classes with out restarting
        classpath("org.springframework:springloaded:1.2.1.RELEASE")
    }
}

// Includes java plugin
apply plugin: 'war'
apply plugin: 'spring-boot'

war {
    archiveName = 'ROOT.war'
    destinationDir = file('webapps')
}

bootRepackage {
    mainClass = 'org.cgiar.ccafs.csa.CSAToolApplication'
}

// Location of the libraries for the application. They are tried from top to bottom.
repositories {
    mavenLocal()
    jcenter()
    maven { 
        url "http://repo.spring.io/libs-release"
        url "http://repository.primefaces.org"
        url "http://lightadmin.org/nexus/content/repositories/snapshots" 
    }    
}

/*
* These dependencies actually determinate the behavior of the application. Spring boot
* Searches the jars and configures the app in a way that works with the libraries.
* This particular app, has support for Spring Mvc, JPA and Security. LightAdmin, 
* Prime Faces with extensions, Postgresql and H2 databases, and an embedded Tomcat.
*/
dependencies {

    compile "org.springframework.boot:spring-boot-starter:1.2.0.RC2"
    
    compile "org.springframework:spring-webmvc:4.1.2.RELEASE"
    compile "org.springframework:spring-aspects:4.1.2.RELEASE"
    compile "org.aspectj:aspectjweaver:1.8.4"

    // Includes tomcat-embed-core, tomcat-embed-el, ecj
    providedCompile "org.apache.tomcat.embed:tomcat-embed-jasper:8.0.15"
    providedCompile "org.apache.tomcat.embed:tomcat-embed-logging-juli:8.0.15"

    compile "com.sun.faces:jsf-api:2.2.8-02"
    compile "com.sun.faces:jsf-impl:2.2.8-02"

    // Includes primefaces
    //compile "org.primefaces.extensions:primefaces-extensions:3.0.0"
    //compile 'org.primefaces.extensions:master-pom:3.5.0'
    compile "org.primefaces:primefaces:5.1"

    compile ("org.springframework.data:spring-data-jpa:1.7.1.RELEASE") {
        exclude module: "aspectjrt"
    }
    compile "org.springframework:spring-orm:4.1.2.RELEASE"
        
    compile "org.hibernate:hibernate-entitymanager:4.3.7.Final"
            
    // Springloaded doesn't like Java 8 version 
    //compile "com.zaxxer:HikariCP-java6:2.2.5"
       
    compile "org.hibernate:hibernate-validator:5.1.3.Final"
    compile "org.postgresql:postgresql:9.3-1102-jdbc41"
    compile "com.h2database:h2:1.4.182"

    compile "com.fasterxml.jackson.core:jackson-databind:2.4.3"
    
    // This needs to remain 2.1.4 to make lightadmin to work 
    compile "org.springframework.data:spring-data-rest-webmvc:2.1.4.RELEASE"

    compile "org.lightadmin:lightadmin:1.1.0.BUILD-SNAPSHOT"
    
    testCompile "org.springframework:spring-test:4.1.2.RELEASE"
    testCompile "junit:junit:4.11"
    testCompile "org.mockito:mockito-core:1.10.8"
    testCompile "org.hamcrest:hamcrest-library:1.3"    
        
}

/*
* Gradle Wrapper task, it downloads Gradle and creates the proper environment for developers
* that get the source code from github.
*/

task wrapper(type: Wrapper) {
    gradleVersion = '2.2.1'
}